{"version":3,"sources":["../src/pictureit_ctrl.js"],"names":["_","MetricsPanelCtrl","panelDefaults","valueMaps","seriesList","series","bgimage","sensors","height","width","PictureItCtrl","$scope","$injector","defaults","panel","events","on","onInitEditMode","bind","render","onDataReceived","dataList","dataListLength","length","push","name","target","value","datapoints","index","splice","xlocation","ylocation","format","bgcolor","color","size","bordercolor","visible","lastSensor","addEditorTab","scope","elem","attrs","ctrl","$panelContainer","find","pixelStrToNum","str","parseInt","substr","css","sensorsLength","valueMapsLength","padding","sensor","ylocationStr","toString","xlocationStr","widthStr","heightStr","lineHeightStr","paddingStr","sizeStr","valueMap","valueFormatted","sprintf","renderingCompleted","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAOA,I;;AACCC,mB,kBAAAA,gB;;;;;;;;;;;;;;;;;;;;;AAIFC,gB,GAAgB;AACrBC,eAAW,EADU;AAErBC,gBAAY,EAFS;AAGrBC,YAAQ,EAHa;AAIrBC,aAAS,EAJY;AAKrBC,aAAS,EALY;AAMrBC,YAAQ,OANa;AAOrBC,WAAO;AAPc,I;;4BAUTC,a;;;AAGX,2BAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,+HACvBD,MADuB,EACfC,SADe;;AAE7BZ,OAAEa,QAAF,CAAW,MAAKC,KAAhB,EAAuBZ,aAAvB;;AAEA,WAAKa,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,WAAKH,MAAL,CAAYC,EAAZ,CAAe,mBAAf,EAAoC,MAAKG,MAAL,CAAYD,IAAZ,OAApC;AACH,WAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKI,cAAL,CAAoBF,IAApB,OAAhC;AACG,WAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKI,cAAL,CAAoBF,IAApB,OAArC;AAP6B;AAQ9B;;;;oCAEcG,Q,EAAU;AAC1B,UAAIC,iBAAiBD,SAASE,MAA9B;AACA,WAAKT,KAAL,CAAWX,SAAX,GAAqB,EAArB;AACA,WAAK,IAAIE,SAAO,CAAhB,EAAkBA,SAAOiB,cAAzB,EAAwCjB,QAAxC,EAAkD;AACjD,YAAKS,KAAL,CAAWX,SAAX,CAAqBqB,IAArB,CAA0B,EAACC,MAAKJ,SAAShB,MAAT,EAAiBqB,MAAvB,EAA8BC,OAAMN,SAAShB,MAAT,EAAiBuB,UAAjB,CAA4BP,SAAShB,MAAT,EAAiBuB,UAAjB,CAA4BL,MAA5B,GAAmC,CAA/D,EAAkE,CAAlE,CAApC,EAA1B;AACA;;AAEE,WAAKJ,MAAL;AACD;;;kCAEYU,K,EAAO;AACrB,WAAKf,KAAL,CAAWP,OAAX,CAAmBuB,MAAnB,CAA0BD,KAA1B,EAAgC,CAAhC;AACE;;;iCAEW;AACb,UAAI,KAAKf,KAAL,CAAWP,OAAX,CAAmBgB,MAAnB,IAA2B,CAA/B,EACC,KAAKT,KAAL,CAAWP,OAAX,CAAmBiB,IAAnB,CAAwB,EAACC,MAAM,UAAP,EAAmBM,WAAW,GAA9B,EAAkCC,WAAW,GAA7C,EAAkDvB,OAAO,GAAzD,EAA8DD,QAAQ,GAAtE,EAA2EyB,QAAQ,MAAnF,EAA0FC,SAAQ,qBAAlG,EAAwHC,OAAM,SAA9H,EAAwIC,MAAK,EAA7I,EAAiJC,aAAY,gBAA7J,EAA8KC,SAAQ,IAAtL,EAAxB,EADD,KAEK;AACJ,WAAIC,aAAW,KAAKzB,KAAL,CAAWP,OAAX,CAAmB,KAAKO,KAAL,CAAWP,OAAX,CAAmBgB,MAAnB,GAA0B,CAA7C,CAAf;;AAEA,YAAKT,KAAL,CAAWP,OAAX,CAAmBiB,IAAnB,CAAwB,EAACC,MAAMc,WAAWd,IAAlB,EAAwBM,WAAW,GAAnC,EAAuCC,WAAW,GAAlD,EAAuDvB,OAAO8B,WAAW9B,KAAzE,EAAgFD,QAAQ+B,WAAW/B,MAAnG,EAA2GyB,QAAQM,WAAWN,MAA9H,EAAsIC,SAAQK,WAAWL,OAAzJ,EAAkKC,OAAMI,WAAWJ,KAAnL,EAA0LC,MAAKG,WAAWH,IAA1M,EAAgNC,aAAYE,WAAWF,WAAvO,EAAoPC,SAAQ,IAA5P,EAAxB;AACA;AACC;;;sCAEgB;AACf,WAAKE,YAAL,CAAkB,SAAlB,EAA6B,oDAA7B,EAAmF,CAAnF;AACD;;;0BAEIC,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAC7B,UAAIrC,OAAJ;AACH,UAAIJ,SAAJ;;AAEA,UAAM0C,kBAAkBH,KAAKI,IAAL,CAAU,kBAAV,CAAxB;;AAEA,eAASC,aAAT,CAAuBC,GAAvB,EAA4B;AAC3B,cAAOC,SAASD,IAAIE,MAAJ,CAAW,CAAX,EAAaF,IAAIzB,MAAJ,GAAW,CAAxB,CAAT,CAAP;AACA;;AAEE,eAASJ,MAAT,GAAkB;AAChB,WAAI,CAACyB,KAAK9B,KAAL,CAAWP,OAAhB,EAAyB;AAAE;AAAS;AACvC,WAAIE,QAAQsC,cAAcF,gBAAgBM,GAAhB,CAAoB,OAApB,CAAd,CAAZ;AACA,WAAI3C,SAASuC,cAAcF,gBAAgBM,GAAhB,CAAoB,QAApB,CAAd,CAAb;;AAEG5C,iBAAUqC,KAAK9B,KAAL,CAAWP,OAArB;AACHJ,mBAAYyC,KAAK9B,KAAL,CAAWX,SAAvB;;AAEA,WAAIiD,gBAAgB7C,QAAQgB,MAA5B;AACA,WAAI8B,kBAAkBlD,UAAUoB,MAAhC;AACA,WAAI+B,UAAU,CAAd;;AAEA,YAAK,IAAIC,SAAO,CAAhB,EAAkBA,SAAOH,aAAzB,EAAuCG,QAAvC,EAAiD;AAClDhD,gBAAQgD,MAAR,EAAgBjB,OAAhB,GAA0B/B,QAAQgD,MAAR,EAAgBxB,SAAhB,GAA0BtB,KAA1B,IAAmCF,QAAQgD,MAAR,EAAgBvB,SAAhB,GAA0BxB,MAAvF;AACAD,gBAAQgD,MAAR,EAAgBC,YAAhB,GAA6BjD,QAAQgD,MAAR,EAAgBvB,SAAhB,CAA0ByB,QAA1B,KAAqC,IAAlE;AACAlD,gBAAQgD,MAAR,EAAgBG,YAAhB,GAA6BnD,QAAQgD,MAAR,EAAgBxB,SAAhB,CAA0B0B,QAA1B,KAAqC,IAAlE;AACAlD,gBAAQgD,MAAR,EAAgBI,QAAhB,GAAyBpD,QAAQgD,MAAR,EAAgB9C,KAAhB,CAAsBgD,QAAtB,KAAiC,IAA1D;AACAlD,gBAAQgD,MAAR,EAAgBK,SAAhB,GAA0BrD,QAAQgD,MAAR,EAAgB/C,MAAhB,CAAuBiD,QAAvB,KAAkC,IAA5D;AACAlD,gBAAQgD,MAAR,EAAgBM,aAAhB,GAA8B,CAACtD,QAAQgD,MAAR,EAAgB/C,MAAhB,GAAwB,IAAE8C,OAA3B,EAAqCG,QAArC,KAAgD,IAA9E;AACAlD,gBAAQgD,MAAR,EAAgBO,UAAhB,GAA2BR,QAAQG,QAAR,KAAmB,IAA9C;AACAlD,gBAAQgD,MAAR,EAAgBQ,OAAhB,GAAwBxD,QAAQgD,MAAR,EAAgBnB,IAAhB,CAAqBqB,QAArB,KAAgC,IAAxD;AACA,aAAK,IAAIO,WAAS,CAAlB,EAAoBA,WAASX,eAA7B,EAA6CW,UAA7C,EAAyD;AACxD,aAAIzD,QAAQgD,MAAR,EAAgB9B,IAAhB,IAAsBtB,UAAU6D,QAAV,EAAoBvC,IAA9C,EAAoD;AACnDlB,kBAAQgD,MAAR,EAAgBU,cAAhB,GAA+BC,QAAQ3D,QAAQgD,MAAR,EAAgBtB,MAAxB,EAA+B9B,UAAU6D,QAAV,EAAoBrC,KAAnD,CAA/B;AACA;AACA;AACD;AACC;AACC;;AAED,WAAKZ,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAClCG;AACAyB,YAAKuB,kBAAL;AACD,OAHD;AAID;;;;KArFgClE,gB;;;;AAwFnCS,iBAAc0D,WAAd,GAA4B,aAA5B","file":"pictureit_ctrl.js","sourcesContent":["import _ from 'lodash';\r\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport './sprintf.js';\r\nimport './angular-sprintf.js';\r\n\r\nconst panelDefaults = {\r\n\tvalueMaps: [],\r\n\tseriesList: [],\r\n\tseries: [],\r\n\tbgimage: '',\r\n\tsensors: [],\r\n\theight: '400px',\r\n\twidth: '100px'\r\n};\r\n\r\nexport class PictureItCtrl extends MetricsPanelCtrl  {\r\n  \r\n  \r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n    _.defaults(this.panel, panelDefaults);\r\n\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('panel-initialized', this.render.bind(this));\r\n\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n  }\r\n\r\n  onDataReceived(dataList) {\t\r\n\tvar dataListLength = dataList.length;\r\n\tthis.panel.valueMaps=[];\r\n\tfor (var series=0;series<dataListLength;series++) {\t\t\r\n\t\tthis.panel.valueMaps.push({name:dataList[series].target,value:dataList[series].datapoints[dataList[series].datapoints.length-1][0]});\r\n\t}\r\n\t\r\n    this.render();\r\n  }\r\n  \r\n  deleteSensor(index) {\r\n\tthis.panel.sensors.splice(index,1);\r\n  }\r\n  \r\n  addSensor() {\r\n\tif (this.panel.sensors.length==0)\r\n\t\tthis.panel.sensors.push({name: 'A-series', xlocation: 200,ylocation: 200, width: 100, height: 100, format: '%.2f',bgcolor:'rgba(0, 0, 0, 0.58)',color:'#FFFFFF',size:22, bordercolor:'rgb(251, 4, 4)',visible:true});\r\n\telse {\r\n\t\tvar lastSensor=this.panel.sensors[this.panel.sensors.length-1];\r\n\t\r\n\t\tthis.panel.sensors.push({name: lastSensor.name, xlocation: 200,ylocation: 200, width: lastSensor.width, height: lastSensor.height, format: lastSensor.format, bgcolor:lastSensor.bgcolor, color:lastSensor.color, size:lastSensor.size, bordercolor:lastSensor.bordercolor, visible:true});\r\n\t}\r\n  }\r\n  \r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/plugins/bessler-pictureit-panel/editor.html', 2);\r\n  }\r\n\t\r\n  link(scope, elem, attrs, ctrl) {\r\n    var sensors;\r\n\tvar valueMaps;\r\n\r\n\tconst $panelContainer = elem.find('.panel-container');\r\n\r\n\tfunction pixelStrToNum(str) {\r\n\t\treturn parseInt(str.substr(0,str.length-2));\r\n\t}\r\n\t\r\n    function render() {\r\n      if (!ctrl.panel.sensors) { return; }\r\n\t  var width = pixelStrToNum($panelContainer.css(\"width\"));\r\n\t  var height = pixelStrToNum($panelContainer.css(\"height\"));\r\n\t  \r\n      sensors = ctrl.panel.sensors;\t  \r\n\t  valueMaps = ctrl.panel.valueMaps;\r\n\t  \r\n\t  var sensorsLength = sensors.length;\r\n\t  var valueMapsLength = valueMaps.length;\r\n\t  var padding = 5;\r\n\t  \r\n\t  for (var sensor=0;sensor<sensorsLength;sensor++) {\r\n\t\tsensors[sensor].visible = sensors[sensor].xlocation<width && sensors[sensor].ylocation<height;\r\n\t\tsensors[sensor].ylocationStr=sensors[sensor].ylocation.toString()+\"px\";\r\n\t\tsensors[sensor].xlocationStr=sensors[sensor].xlocation.toString()+\"px\";\r\n\t\tsensors[sensor].widthStr=sensors[sensor].width.toString()+\"px\";\r\n\t\tsensors[sensor].heightStr=sensors[sensor].height.toString()+\"px\";\r\n\t\tsensors[sensor].lineHeightStr=(sensors[sensor].height-(2*padding)).toString()+\"px\";\r\n\t\tsensors[sensor].paddingStr=padding.toString()+\"px\";\r\n\t\tsensors[sensor].sizeStr=sensors[sensor].size.toString()+\"px\";\r\n\t\tfor (var valueMap=0;valueMap<valueMapsLength;valueMap++) {\t\r\n\t\t\tif (sensors[sensor].name==valueMaps[valueMap].name) {\r\n\t\t\t\tsensors[sensor].valueFormatted=sprintf(sensors[sensor].format,valueMaps[valueMap].value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t  }\r\n    }\r\n\r\n    this.events.on('render', function() {\r\n      render();\r\n      ctrl.renderingCompleted();\r\n    });\r\n  }\r\n}\r\n\r\nPictureItCtrl.templateUrl = 'module.html';\r\n"]}